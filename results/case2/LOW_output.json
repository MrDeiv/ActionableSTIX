[{"id": "4df3bef5-c83b-4bbb-9ad9-f830b5a14eb2", "attack_steps": [{"id": "de959eaf-91e4-45b9-9fb9-e5afbb07e211", "name": "Supply Chain Compromise: Compromise Software Dependencies and Development Tools as used by the malware", "description": "The \"Smooth Operator\" malware compromises the software supply chain through a multi-stage process:\n\nMalicious libraries are injected into the legitimate 3CX software development process during the build stage of the 3CXDesktopApp application.  Legitimate 3CX software components are subsequently trojanized, incorporating the Smooth Operator malware without user awareness. To enhance deception, the infected software is signed by 3CX and notarized by Apple, fostering a perception of security and legitimacy. Distribution occurs through established channels, including official downloads and software repositories, resulting in unwitting download and installation of compromised software by users.  \n", "mitre_technique": {"id": "T1195.001", "name": "Supply chain compromise: compromise software dependencies and development tools", "description": "Adversaries may manipulate software dependencies and development tools prior to receipt by a final consumer for the purpose of data or system compromise. Applications often depend on external software to function properly. Popular open source projects that are used as dependencies in many applications may be targeted as a means to add malicious code to users of the dependency."}, "pre-conditions": ["\nThe software development process for the targeted application is accessible.\n", "\nTools for integrating malicious libraries into the build process.\n", "\nThe target application relies on legitimate dependencies.\n", "\nKnowledge of the software's build process and dependencies.\n", "\nConnectivity to download and install necessary tools.\n"], "post-conditions": ["\nCompromised 3CX software installations\n", "\nPresence of malicious dylib file (libffmpeg.dylib)\n", "\nNetwork connections to the exfiltration URL (https:// sbmsa[.]wiki/blog/_insert)\n", "\n.main_storage file required for second-stage execution\n", "\nConfiguration files written by Smooth Operator in the legitimate 3CX installation directory\n", "\nPotential for further malware execution and lateral movement\n", "\nLogs indicating execution of Smooth Operator components\n", "\nModified 3CX software installation packages\n", "\nBeaconing activity from infected systems\n", "\nData exfiltration from infected systems\n", "\nVictim ID included in malware beacons and exfiltration data\n"], "indicators": ["Domain names may be registered for malicious purposes.", "Files with unusual or generic names may be created."]}], "pre-conditions": ["\nThe software development process for the targeted application is accessible.\n", "\nTools for integrating malicious libraries into the build process.\n", "\nThe target application relies on legitimate dependencies.\n", "\nKnowledge of the software's build process and dependencies.\n", "\nConnectivity to download and install necessary tools.\n"], "post-conditions": ["\nCompromised 3CX software installations\n", "\nPresence of malicious dylib file (libffmpeg.dylib)\n", "\nNetwork connections to the exfiltration URL (https:// sbmsa[.]wiki/blog/_insert)\n", "\n.main_storage file required for second-stage execution\n", "\nConfiguration files written by Smooth Operator in the legitimate 3CX installation directory\n", "\nPotential for further malware execution and lateral movement\n", "\nLogs indicating execution of Smooth Operator components\n", "\nModified 3CX software installation packages\n", "\nBeaconing activity from infected systems\n", "\nData exfiltration from infected systems\n", "\nVictim ID included in malware beacons and exfiltration data\n"]}, {"id": "be153954-f4a4-4c19-8865-efb4e400d52a", "attack_steps": [{"id": "d3a56339-86f1-4eb1-87ed-60bf987f825e", "name": "Compromise Client Software Binary as used by the malware", "description": "The Smooth Operator malware establishes persistence on victim systems by compromising legitimate 3CX client software binaries. This is achieved through the Trojanized distribution of tampered 3CX software packages, resulting in unwitting installation of the malware alongside intended software. Malicious code, including the \"Smooth Operator\" payload, is injected into the 3CX software binary, enabling execution as part of the legitimate application. Upon execution of the compromised 3CX software by victims, the embedded malicious code persists, ensuring Smooth Operator's presence on the system even after system restarts or logouts.  \n", "mitre_technique": {"id": "T1554", "name": "Compromise host software binary", "description": "Adversaries may modify host software binaries to establish persistent access to systems. Software binaries/executables provide a wide range of system commands or services, programs, and libraries. Common software binaries are SSH clients, FTP clients, email clients, web browsers, and many other user or server applications."}, "pre-conditions": ["\nA system running the 3CX software.\n", "\nThe 3CX software package is installed on the victim's system.\n", "\nThe malicious dylib file (libffmpeg.dylib) is present within the 3CX software package.\n"], "post-conditions": ["\nModified libffmpeg.dylib file\n", "\nConfiguration files written to the 3CX installation directory\n", "\nFiles containing exfiltrated data\n", "\nNetwork connections to the C2 server\n", "\nPersistent malware execution on victim's system\n", "\nCompromised 3CX software installation\n", "\nData exfiltration to a Command and Control (C2) server\n", "\nLogs of malware communication with C2 server\n", "\n\"UpdateAgent\" binary files\n", "\nPotential for further malicious activity\n"], "indicators": ["Filename: UpdateAgent", "Filename: .main_storage"]}], "pre-conditions": ["\nA system running the 3CX software.\n", "\nThe 3CX software package is installed on the victim's system.\n", "\nThe malicious dylib file (libffmpeg.dylib) is present within the 3CX software package.\n"], "post-conditions": ["\nModified libffmpeg.dylib file\n", "\nConfiguration files written to the 3CX installation directory\n", "\nFiles containing exfiltrated data\n", "\nNetwork connections to the C2 server\n", "\nPersistent malware execution on victim's system\n", "\nCompromised 3CX software installation\n", "\nData exfiltration to a Command and Control (C2) server\n", "\nLogs of malware communication with C2 server\n", "\n\"UpdateAgent\" binary files\n", "\nPotential for further malicious activity\n"]}, {"id": "b8a7e893-ffa3-40dc-b75c-de3b43f441ea", "attack_steps": [{"id": "2c381e0f-65ba-4a84-9e45-2080de440484", "name": "Deobfuscate/Decode Files or Information as used by the malware", "description": "Smooth Operator's multi-layered approach to data obfuscation and handling is characterized by:\n\n1. C2 Communication Obfuscation: \nData transmitted over the Command and Control (C2) channel undergoes scrambling via a custom algorithm, rendering analysis of communication traffic challenging for security tools.  Furthermore, specific symbols are replaced with their HTML encoded counterparts within the obfuscated strings, aiming to camouflage malicious data as legitimate web code.\n\n2. On-Disk Data Handling:\nUpon disk write operations, Smooth Operator applies the reverse of its C2 communication obfuscation algorithm, effectively decoding the information for local storage. Similarly, responses received from the command and control server are decoded prior to processing.\n\n3. Data Flow:\nData collection encompasses sensitive information extracted from the 3CX system, potentially including user credentials, communication logs, and other valuable data. The collected data is then encrypted using its custom algorithm and HTML encoded before transmission to the C2 server. Upon receipt of obfuscated data, the C2 server decodes it and may transmit instructions back to Smooth Operator.  Smooth Operator decodes any responses from the C2 server and executes them on the victim's system, potentially involving further data exfiltration, lateral movement within the network, or other malicious activities.\n\n\n\nPotential Impact:\n\nData theft, encompassing user credentials, financial data, and confidential business documents, is a potential consequence.  Smooth Operator may also gain control of the victim's network, facilitating further attacks and data breaches. Business disruption, resulting from communication system outages and critical service interruptions, can lead to significant downtime and financial losses.\n\n\n\nMitigation:\n\nOrganizations are advised to:\n\n- Update 3CX Software promptly with patches and updates released by 3CX to address known vulnerabilities exploited by Smooth Operator.\n- Implement Multi-Factor Authentication (MFA) for all user accounts, particularly those with administrative privileges, to enhance security against credential theft.\n- Harden network security through the implementation of robust firewalls, intrusion detection and prevention systems (IDPS), and network segmentation to limit malware lateral movement and impact.\n- Conduct security awareness training to educate users about phishing attacks and social engineering tactics employed by attackers to deliver malware such as Smooth Operator. \n\n\n", "mitre_technique": {"id": "T1140", "name": "Deobfuscate/decode files or information", "description": "Adversaries may use Obfuscated Files or Information to hide artifacts of an intrusion from analysis. They may require separate mechanisms to decode or deobfuscate that information depending on how they intend to use it. Methods for doing that include built-in functionality of malware or by using utilities present on the system."}, "pre-conditions": ["\nAccess to files containing obfuscated data.\n", "\nA system infected with Smooth Operator malware.\n", "\nThe malware has been executed.\n", "\nData needs to be deobfuscated.\n", "\nSmooth Operator's custom data encoding algorithm is available.\n"], "post-conditions": ["\nModified 3CX installation directory\n", "\nObfuscated data files\n", "\nData exfiltration to C2 server\n", "\nNetwork traffic to C2 server (HTTPS)\n", "\nCompromised 3CX software functionality\n", "\n\"UpdateAgent\" file containing malicious code\n", "\nLogs indicating suspicious activity\n", "\nAltered system configurations\n", "\nPotential disruption of communication systems\n", "\nIncreased risk of further attacks\n"], "indicators": ["Filename: UpdateAgent", "Filename: .main_storage"]}, {"id": "381d3c71-5262-448e-a79b-d84d1b4ecd1c", "name": "Indicator Removal: File Deletion as used by the malware", "description": "Indicator Removal: File Deletion is executed by the \"UpdateAgent\" binary, which constitutes the malware's second-stage payload.  Upon execution, the \"UpdateAgent\" binary is immediately deleted from the storage medium. This action is intended to impede threat detection and analysis by eliminating any evidence of its presence on the compromised system. \n\n\n", "mitre_technique": {"id": "T1070.004", "name": "Indicator removal: file deletion", "description": "Adversaries may delete files left behind by the actions of their intrusion activity. Malware, tools, or other non-native files dropped or created on a system by an adversary (ex: Ingress Tool Transfer) may leave traces to indicate to what was done within a network and how. Removal of these files can occur during an intrusion, or as part of a post-intrusion process to minimize the adversary's footprint."}, "pre-conditions": ["\nThe malware's binary is present on disk.\n", "\nThe malware's second stage has been executed.\n", "\nOperating System with file system access capabilities.\n"], "post-conditions": ["\nDeletion of UpdateAgent binary from disk\n", "\nModified system registry settings\n", "\nData exfiltration to https://sbmsa[.]wiki/blog/_insert\n", "\nPotential data theft and system compromise\n", "\nSystem event logs recording process creation and termination\n", "\nLog entries indicating execution of UpdateAgent\n", "\nNetwork traffic logs showing HTTPS GET requests to https://sbmsa[.]wiki/blog/_insert\n", "\nCompromised 3CX installation directory\n"], "indicators": ["Filename: .main_storage"]}, {"id": "aff8c53b-5cbf-414b-be59-706d5cf45cbf", "name": "Virtualization/Sandbox Evasion: Time Based Evasion as used by the malware", "description": "A time-based evasion technique is employed by Smooth Operator to evade detection within virtualized or sandboxed environments.  Following execution, the malware enters a dormant state characterized by a minimum sleep duration of seven days (604,800 seconds) prior to attempting communication with its command and control (C2) server. This extended latency period facilitates evasion by security tools that primarily monitor for immediate suspicious activity within a short timeframe. The limited lifespans often inherent in virtualization/sandbox environments further diminish the likelihood of these environments persisting sufficiently long enough for Smooth Operator to reactivate and initiate communication. \n\n\n", "mitre_technique": {"id": "T1497.003", "name": "Virtualization/sandbox evasion: time based evasion", "description": "Adversaries may employ various time-based methods to detect and avoid virtualization and analysis environments. This may include enumerating time-based properties, such as uptime or the system clock, as well as the use of timers or other triggers to avoid a virtual machine environment (VME) or sandbox, specifically those that are automated or only operate for a limited amount of time."}, "pre-conditions": ["\nThe malware is executed.\n", "\nThe .main_storage file exists.\n", "\nThe ability to access and modify files on disk (e.g., write to the .main_storage file).\n", "\nA system running an operating system compatible with the malware's execution.\n", "\nNetwork connectivity to reach the internet for communication with C2 servers.\n"], "post-conditions": ["\nPersistence on the system\n", "\nDeleted files (Smooth Operator)\n", "\nData exfiltration\n", "\nRegistry entries for persistence\n", "\nModified files (UpdateAgent, .main_storage)\n", "\nSystem logs indicating process execution and file modifications\n", "\nCompromised system\n", "\nNetwork traffic to C2 servers over HTTPS\n"], "indicators": ["The filename \".main_storage\" is observed."]}], "pre-conditions": ["\nAccess to files containing obfuscated data.\n", "\nA system infected with Smooth Operator malware.\n", "\nThe malware has been executed.\n", "\nData needs to be deobfuscated.\n", "\nSmooth Operator's custom data encoding algorithm is available.\n", "\nThe malware's binary is present on disk.\n", "\nThe malware's second stage has been executed.\n", "\nOperating System with file system access capabilities.\n", "\nThe malware is executed.\n", "\nThe .main_storage file exists.\n", "\nThe ability to access and modify files on disk (e.g., write to the .main_storage file).\n", "\nA system running an operating system compatible with the malware's execution.\n", "\nNetwork connectivity to reach the internet for communication with C2 servers.\n"], "post-conditions": ["\nModified 3CX installation directory\n", "\nObfuscated data files\n", "\nData exfiltration to C2 server\n", "\nNetwork traffic to C2 server (HTTPS)\n", "\nCompromised 3CX software functionality\n", "\n\"UpdateAgent\" file containing malicious code\n", "\nLogs indicating suspicious activity\n", "\nAltered system configurations\n", "\nPotential disruption of communication systems\n", "\nIncreased risk of further attacks\n", "\nDeletion of UpdateAgent binary from disk\n", "\nModified system registry settings\n", "\nData exfiltration to https://sbmsa[.]wiki/blog/_insert\n", "\nPotential data theft and system compromise\n", "\nSystem event logs recording process creation and termination\n", "\nLog entries indicating execution of UpdateAgent\n", "\nNetwork traffic logs showing HTTPS GET requests to https://sbmsa[.]wiki/blog/_insert\n", "\nCompromised 3CX installation directory\n", "\nPersistence on the system\n", "\nDeleted files (Smooth Operator)\n", "\nData exfiltration\n", "\nRegistry entries for persistence\n", "\nModified files (UpdateAgent, .main_storage)\n", "\nSystem logs indicating process execution and file modifications\n", "\nCompromised system\n", "\nNetwork traffic to C2 servers over HTTPS\n"]}, {"id": "dc607202-1a7d-4675-aee6-8822d269b07d", "attack_steps": [{"id": "ca6be80e-2bcb-46bd-ad22-8a72cda6554a", "name": "Automated Collection as used by the malware", "description": "Data is collected from infected victim machines through automated processes implemented by Smooth Operator malware. System details, including operating system and hardware specifications, are extracted alongside information pertaining to running processes and network connections. User credentials and sensitive files are also targeted for acquisition.  \n\nSpecific data related to 3CX systems, such as call logs and configurations, may be gathered. The collected data is subsequently organized and prepared for transmission to the attacker's command and control (C2) server. This staged data may be embedded within beacon messages transmitted periodically to the C2 or transferred through dedicated exfiltration channels.\n\nTransmission of the gathered data to the C2 server is facilitated by HTTPS communication, thereby obscuring detection by conventional security measures.  \n", "mitre_technique": {"id": "T1119", "name": "Automated collection", "description": "Once established within a system or network, an adversary may use automated techniques for collecting internal data. Methods for performing this technique could include use of a Command and Scripting Interpreter to search for and copy information fitting set criteria such as file type, location, or name at specific time intervals."}, "pre-conditions": ["\nThe malware is running on a victim machine.\n", "\nThe ability to process and format collected data.\n", "\nThe ability to read data from the SystemVersion.plist file.\n", "\nA functioning internet connection.\n", "\nThe SystemVersion.plist file exists in /System/Library/CoreServices/.\n"], "post-conditions": ["\nHTTP GET requests to exfiltration URL\n", "\nBeacon communication logs\n", "\nNew files created (e.g., UpdateAgent)\n", "\nSystem instability\n", "\nCookie header modifications with victim data\n", "\nAltered registry settings\n", "\nLogs containing suspicious activity\n", "\nNetwork traffic to C2 servers over HTTPS\n", "\nModified system files\n", "\nData theft\n", "\nCompromised system\n", "\nPotential for further malware infections\n"], "indicators": ["A file named \"UpdateAgent\" is present.", "A file named \".main_storage\" is present."]}], "pre-conditions": ["\nThe malware is running on a victim machine.\n", "\nThe ability to process and format collected data.\n", "\nThe ability to read data from the SystemVersion.plist file.\n", "\nA functioning internet connection.\n", "\nThe SystemVersion.plist file exists in /System/Library/CoreServices/.\n"], "post-conditions": ["\nHTTP GET requests to exfiltration URL\n", "\nBeacon communication logs\n", "\nNew files created (e.g., UpdateAgent)\n", "\nSystem instability\n", "\nCookie header modifications with victim data\n", "\nAltered registry settings\n", "\nLogs containing suspicious activity\n", "\nNetwork traffic to C2 servers over HTTPS\n", "\nModified system files\n", "\nData theft\n", "\nCompromised system\n", "\nPotential for further malware infections\n"]}, {"id": "baf33047-eae9-4809-ab7c-4c052b50563e", "attack_steps": [{"id": "d6f23d7b-7408-4b7d-8bb8-9f8d78457b33", "name": "Application Layer Protocol: Web Protocols as used by the malware", "description": "C2 communication for the malware is established via the HTTPS protocol.  Encrypted connections are utilized for all interactions between the infected machine and the C2 server. This encryption complicates monitoring and interception efforts by security analysts, thereby enhancing the stealthiness of the malware's operations. \n\n\n", "mitre_technique": {"id": "T1071.001", "name": "Application layer protocol: web protocols", "description": "Adversaries may communicate using application layer protocols associated with web traffic to avoid detection/network filtering by blending in with existing traffic. Commands to the remote system, and often the results of those commands, will be embedded within the protocol traffic between the client and server."}, "pre-conditions": ["\nThe malware is running.\n", "\nA system capable of executing the malware code exists.\n", "\nA network connection is available.\n", "\nHTTPS protocol support is present.\n", "\nThe malware has a list of C2 servers.\n"], "post-conditions": ["\nObfuscated data remnants\n", "\nRegistry entries\n", "\nDownloaded files (e.g., icon files)\n", "\nData exfiltration\n", "\nModified cookies\n", "\nExfiltration logs\n", "\n.main_storage file with beaconing information\n", "\nC2 server logs\n", "\nSystem compromise\n", "\nMalware persistence\n", "\nModified system files\n", "\nPotential data loss\n", "\nNetwork traffic analysis (HTTPS requests)\n"], "indicators": ["The domain \"azureonlinestorage.com\" is accessed.", "The domain \"akamaitechcloudservices.com\" is accessed.", "The domain \"sourceslabs.com\" is accessed.", "The domain \"pbxcloudeservices.com\" is accessed.", "The domain \"pbxphonenetwork.com\" is accessed.", "The domain \"msstorageboxes.com\" is accessed.", "The domain \"officeaddons.com\" is accessed.", "The domain \"zacharryblogs.com\" is accessed.", "The domain \"glcloudservice.com\" is accessed."]}, {"id": "b490636b-898d-4931-b0b2-495b5509a3a0", "name": "Fallback Channels as used by the malware", "description": "Command and Control (C2) server communication is facilitated by a fallback mechanism employing a predetermined list of servers.  During each beacon transmission attempt, a C2 server is randomly selected from this list. A connection attempt is subsequently initiated with the chosen server. Upon successful establishment of the connection, standard communication protocols are executed. In the event of a connection failure, the malware proceeds to the subsequent C2 server on the list and reiterates the selection and connection processes. This iterative procedure persists until a successful connection is realized.  This strategy ensures uninterrupted communication with the command center by leveraging alternative servers in the event of unavailability of primary servers. \n\n\n", "mitre_technique": {"id": "T1008", "name": "Fallback channels", "description": "Adversaries may use fallback or alternate communication channels if the primary channel is compromised or inaccessible in order to maintain reliable command and control and to avoid data transfer thresholds."}, "pre-conditions": ["\nThe malware is running.\n", "\nA list of C2 servers is available to the malware.\n", "\nThe malware has the capability to communicate over a network.\n", "\nA C2 server is unreachable.\n"], "post-conditions": ["\nData exfiltration\n", "\nExfiltrated data files\n", "\nObfuscated C2 communication logs\n", "\nUnusual process activity logs\n", "\nMalware persistence\n", "\nModified system files\n", "\nCompromised systems\n", "\nNetwork traffic to C2 servers and exfiltration URLs\n"], "indicators": ["A domain name is used.", "A file named \"UpdateAgent\" is present."]}], "pre-conditions": ["\nThe malware is running.\n", "\nA system capable of executing the malware code exists.\n", "\nA network connection is available.\n", "\nHTTPS protocol support is present.\n", "\nThe malware has a list of C2 servers.\n", "\nThe malware is running.\n", "\nA list of C2 servers is available to the malware.\n", "\nThe malware has the capability to communicate over a network.\n", "\nA C2 server is unreachable.\n"], "post-conditions": ["\nObfuscated data remnants\n", "\nRegistry entries\n", "\nDownloaded files (e.g., icon files)\n", "\nData exfiltration\n", "\nModified cookies\n", "\nExfiltration logs\n", "\n.main_storage file with beaconing information\n", "\nC2 server logs\n", "\nSystem compromise\n", "\nMalware persistence\n", "\nModified system files\n", "\nPotential data loss\n", "\nNetwork traffic analysis (HTTPS requests)\n", "\nData exfiltration\n", "\nExfiltrated data files\n", "\nObfuscated C2 communication logs\n", "\nUnusual process activity logs\n", "\nMalware persistence\n", "\nModified system files\n", "\nCompromised systems\n", "\nNetwork traffic to C2 servers and exfiltration URLs\n"]}, {"id": "8d6a9cb2-d340-476b-8b34-d2c410a38706", "attack_steps": [{"id": "99ed12e7-ddee-4902-9f91-bff76d5e320d", "name": "Automated Exfiltration as used by the malware", "description": "Automated exfiltration of victim data collected by Smooth Operator is conducted through a separate channel distinct from its primary Command and Control (C2) infrastructure.  The specific methodology employed by this distinct channel remains undisclosed. It is evident, however, that the exfiltration process operates independently of the C2 communication channels utilized for other malicious activities. \n\n\n", "mitre_technique": {"id": "T1020", "name": "Automated exfiltration", "description": "Adversaries may exfiltrate data, such as sensitive documents, through the use of automated processing after being gathered during Collection."}, "pre-conditions": ["\nThe .main_storage file is present.\n", "\nA network connection is available.\n", "\nThe malware has collected victim specific data.\n", "\nThe malware has access to the internet.\n", "\nThe malware has successfully infected a target system.\n"], "post-conditions": ["\nNetwork traffic to obfuscated C2 servers.\n", "\nPresence of malicious code in memory.\n", "\nRegistry modifications related to malware execution.\n", "\nSystem instability or performance degradation.\n", "\nIncreased risk of further attacks.\n", "\nPotential compromise of sensitive information.\n", "\nModified system files.\n", "\nNew log entries indicating suspicious activity.\n", "\nData exfiltration from infected systems.\n", "\nExfiltrated data files on remote servers.\n"], "indicators": ["A file named \"UpdateAgent\" is present.", "A file named \".main_storage\" is present."]}], "pre-conditions": ["\nThe .main_storage file is present.\n", "\nA network connection is available.\n", "\nThe malware has collected victim specific data.\n", "\nThe malware has access to the internet.\n", "\nThe malware has successfully infected a target system.\n"], "post-conditions": ["\nNetwork traffic to obfuscated C2 servers.\n", "\nPresence of malicious code in memory.\n", "\nRegistry modifications related to malware execution.\n", "\nSystem instability or performance degradation.\n", "\nIncreased risk of further attacks.\n", "\nPotential compromise of sensitive information.\n", "\nModified system files.\n", "\nNew log entries indicating suspicious activity.\n", "\nData exfiltration from infected systems.\n", "\nExfiltrated data files on remote servers.\n"]}]