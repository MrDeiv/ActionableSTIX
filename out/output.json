[{"id": "bee1e59e-3320-45d8-944c-2702d5dff6e4", "attack_steps": [{"id": "47fc25cc-513d-47e0-a08e-345bd3ecd9b7", "name": "Command and Scripting Interpreter: Python as used by the malware", "description": "The malicious code of MuddyWater malware is encapsulated within a PyInstaller executable, thereby obscuring its Python scripting language foundation.  This encapsulation technique hinders detection by conventional antivirus software. \n\n\n", "mitre_technique": {"id": "T1059.006", "name": "Command and scripting interpreter: python", "description": "Adversaries may abuse Python commands and scripts for execution. Python is a very popular scripting/programming language, with capabilities to perform many functions. Python can be executed interactively from the command-line (via the python.exe interpreter) or via scripts (.py) that can be written and distributed to different systems. Python code can also be compiled into binary executables."}, "pre-conditions": ["\nAccess to a Python interpreter.\n", "\nMuddyWater actors have developed tools in Python.\n", "\nConnectivity to command and control servers (implied for tool deployment and communication).\n"], "post-conditions": ["\nPowerShell scripts used for execution and communication.\n", "\nNetwork traffic to Telegram servers using bot API.\n", "\nFiles downloaded from external URLs containing malicious code.\n", "\nCompromised system with persistent malware infection.\n", "\nPotential for further lateral movement and escalation within the compromised network.\n", "\nIndicators of compromise (IOCs) matching known MuddyWater tactics and techniques.\n", "\nModified system proxy settings.\n", "\nAltered registry entries related to malware persistence.\n", "\nIncreased risk of ransomware attacks or other malicious activities.\n", "\nLogs indicating suspicious activity, including command executions and data transfers.\n", "\nData exfiltration to external servers controlled by MuddyWater actors.\n", "\nSmall Sieve payload files on infected systems.\n"], "indicators": []}], "pre-conditions": ["\nAccess to a Python interpreter.\n", "\nMuddyWater actors have developed tools in Python.\n", "\nConnectivity to command and control servers (implied for tool deployment and communication).\n"], "post-conditions": ["\nPowerShell scripts used for execution and communication.\n", "\nNetwork traffic to Telegram servers using bot API.\n", "\nFiles downloaded from external URLs containing malicious code.\n", "\nCompromised system with persistent malware infection.\n", "\nPotential for further lateral movement and escalation within the compromised network.\n", "\nIndicators of compromise (IOCs) matching known MuddyWater tactics and techniques.\n", "\nModified system proxy settings.\n", "\nAltered registry entries related to malware persistence.\n", "\nIncreased risk of ransomware attacks or other malicious activities.\n", "\nLogs indicating suspicious activity, including command executions and data transfers.\n", "\nData exfiltration to external servers controlled by MuddyWater actors.\n", "\nSmall Sieve payload files on infected systems.\n"]}, {"id": "330cbfd0-55de-49c7-be51-869a8e1fe7c3", "attack_steps": [{"id": "1564a1ca-e1a5-4d60-a028-e8e62eaa53ab", "name": "Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder as used by the malware", "description": "Persistence on the victim's system is established by the \"Small Sieve\" malware through the addition of itself to the HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run key within the Windows Registry.  A new entry, designated as either \"SystemTextEncoding\" or potentially \"OutlookMicrosift\", is created within this key. Upon system boot or user logon, any programs listed in the Run key are automatically executed by Windows, resulting in the malware's execution on each instance. \n\n\n", "mitre_technique": {"id": "T1547.001", "name": "Boot or logon autostart execution: registry run keys / startup folder", "description": "Adversaries may achieve persistence by adding a program to a startup folder or referencing it with a Registry run key. Adding an entry to the \"run keys\" in the Registry or startup folder will cause the program referenced to be executed when a user logs in. These programs will be executed under the context of the user and will have the account's associated permissions level."}, "pre-conditions": ["\nThe victim's operating system has a registry.\n", "\nA Windows operating system is present.\n", "\nThe malware has knowledge of the appropriate registry key path (HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run).\n"], "post-conditions": ["\nSmall Sieve Python script files.\n", "\nCompromised system with persistent malware infection.\n", "\nAltered system text encoding.\n", "\nEmbedded Windows Script Files (.wsf) installed in the startup folder.\n", "\nData exfiltration and potential loss of sensitive information.\n", "\nSystem instability and performance degradation.\n", "\nModified system proxy settings.\n", "\nLaZagne logs and credential dumps.\n", "\nNetwork connections to command-and-control servers.\n", "\nRegistry run keys added for persistence.\n", "\nReshuffled hexadecimal strings in .wsf files.\n", "\nIncreased vulnerability to further attacks.\n"], "indicators": ["Registry value name: HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\OutlookMicrosift", "Path: %AppData%\\OutlookMicrosift\\index.exe"]}], "pre-conditions": ["\nThe victim's operating system has a registry.\n", "\nA Windows operating system is present.\n", "\nThe malware has knowledge of the appropriate registry key path (HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run).\n"], "post-conditions": ["\nSmall Sieve Python script files.\n", "\nCompromised system with persistent malware infection.\n", "\nAltered system text encoding.\n", "\nEmbedded Windows Script Files (.wsf) installed in the startup folder.\n", "\nData exfiltration and potential loss of sensitive information.\n", "\nSystem instability and performance degradation.\n", "\nModified system proxy settings.\n", "\nLaZagne logs and credential dumps.\n", "\nNetwork connections to command-and-control servers.\n", "\nRegistry run keys added for persistence.\n", "\nReshuffled hexadecimal strings in .wsf files.\n", "\nIncreased vulnerability to further attacks.\n"]}, {"id": "1bcfb85c-442e-4605-bb7d-00bbe86a6952", "attack_steps": [{"id": "11562268-b8c6-4750-b7f1-dc4a27250c31", "name": "Obfuscated Files or Information as used by the malware", "description": "MuddyWater malware implements a dual obfuscation strategy encompassing custom hexadecimal byte swapping and an obfuscated Base64 function.  The malware's code and data undergo rearrangement via a non-standard hexadecimal pattern within the byte structure. Subsequently, an obfuscated variant of the Base64 encoding scheme is applied to further conceal the meaning and organization of the encoded information. This combined methodology presents significant challenges for security tools and analysts in deciphering the malware's code, commands, and communication with command-and-control (C2) servers. \n", "mitre_technique": {"id": "T1027.013", "name": "Obfuscated files or information: encrypted/encoded file", "description": "Adversaries may encrypt or encode files to obfuscate strings, bytes, and other specific patterns to impede detection. Encrypting and/or encoding file content aims to conceal malicious artifacts within a file used in an intrusion. Many other techniques, such as Software Packing, Steganography, and Embedded Payloads, share this same broad objective. Encrypting and/or encoding files could lead to a lapse in detection of static signatures, only for this malicious content to be revealed (i.e., Deobfuscate/Decode Files or Information) at the time of execution/use."}, "pre-conditions": ["\nAn active internet connection for communication with Telegram and potential C2 servers.\n", "\nThe malware Small Sieve is present on the victim's system.\n", "\nAn obfuscated Base64 function is implemented within Small Sieve.\n", "\nA custom hex byte swapping encoding scheme is implemented within Small Sieve.\n", "\nThe victim's system has an active internet connection.\n"], "post-conditions": ["\nNetwork connections to unknown servers\n", "\nEncrypted data transfers\n", "\nObfuscated code fragments\n", "\nLateral movement within the network\n", "\nNew executables and files in unexpected locations\n", "\nRegistry modifications\n", "\nCompromised system integrity\n", "\nIncreased vulnerability to further attacks\n", "\nModified system settings\n", "\nLoss of sensitive information\n", "\nAltered log files with suspicious activity\n", "\nData exfiltration\n", "\nModified system processes\n"], "indicators": ["Small Sieve sample (Filename: gram_app.exe)", "Small Sieve sample (Filename: index.exe)", "Path: %LocalAppData%\\MicrosoftWindowsOutlookDataPlus.txt", "Registry value name: HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\OutlookMicrosift", "Path: %AppData%\\OutlookMicrosift\\index.exe"]}, {"id": "e6387ba2-62fc-46e8-9935-5ca0bd564439", "name": "Execution Guardrails as used by the malware", "description": "The execution of MuddyWater's Small Sieve payload is contingent upon the provision of the specific command-line argument \"Platypus.\"  This parameter requirement constitutes an inherent safeguard, as the mere identification and activation of the payload file will not result in successful infection without the stipulated trigger phrase. \n\n\n", "mitre_technique": {"id": "T1480.001", "name": "Execution guardrails: environmental keying", "description": "Adversaries may environmentally key payloads or other features of malware to evade defenses and constraint execution to a specific target environment. Environmental keying uses cryptography to constrain execution or actions based on adversary supplied environment specific conditions that are expected to be present on the target. Environmental keying is an implementation of Execution Guardrails that utilizes cryptographic techniques for deriving encryption/decryption keys from specific types of values in a given computing environment."}, "pre-conditions": ["\nA system running a vulnerable application or process.\n", "\nThe word \"Platypus\" is present in the command line arguments.\n", "\nNetwork connectivity to receive and execute commands from the attacker.\n", "\nThe ability to execute code on the target system.\n"], "post-conditions": ["\nCompromised system credentials\n", "\nHidden configuration files\n", "\nUnusual network connections to Telegram servers\n", "\nObfuscated command and control traffic logs\n", "\nLaZagne output files containing stolen credentials\n", "\nNew executables in user directories\n", "\nNetwork traffic anomalies\n", "\nFiles downloaded from malicious URLs\n", "\nSystem instability\n", "\nMalware persistence\n", "\nPresence of Small Sieve malware code\n", "\nModified system registry entries for persistence\n", "\nAltered log files\n", "\nModified system proxy settings\n", "\nData exfiltration\n"], "indicators": ["Small Sieve sample (Filename: gram_app.exe)", "Small Sieve sample (Filename: index.exe)", "Path: %AppData%\\OutlookMicrosift\\index.exe"]}, {"id": "5867a34b-1153-4ec7-9992-4f6bdad4af19", "name": "Masquerading: Match Legitimate Name or Location as used by the malware", "description": "The malware, designated as Small Sieve, employs filename variations incorporating \"Microsoft\" (represented as \"Microsift\") and \"Outlook.\" This nomenclature is strategically implemented to facilitate camouflage with legitimate Microsoft software applications and potentially circumvent detection during cursory file inspections.  \n", "mitre_technique": {"id": "T1036.005", "name": "Masquerading: match legitimate name or location", "description": "Adversaries may match or approximate the name or location of legitimate files or resources when naming/placing them. This is done for the sake of evading defenses and observation. This may be done by placing an executable in a commonly trusted directory (ex: under System32) or giving it the name of a legitimate, trusted program (ex: svchost.exe). In containerized environments, this may also be done by creating a resource in a namespace that matches the naming convention of a container pod or cluster. Alternatively, a file or container image name given may be a close approximation to legitimate programs/images or something innocuous."}, "pre-conditions": ["\nThe ability to modify file names and registry key names.\n", "\nA target system with a running instance of Small Sieve.\n", "\nKnowledge of legitimate Microsoft and Outlook naming conventions.\n", "\nThe malware Small Sieve is present in the system.\n", "\nThe attacker desires to avoid detection during casual inspection.\n"], "post-conditions": ["\nCompromised system credentials\n", "\nNetwork reconnaissance\n", "\nModified system registry keys\n", "\nUnusual network traffic to command and control servers\n", "\nSuspicious process activity logs\n", "\nModified Outlook data files (.txt)\n", "\nSystem instability\n", "\nMalware persistence\n", "\nAltered log files\n", "\nObfuscated strings in memory\n", "\nTelegram API logs\n", "\nNew files with malicious code\n", "\nData exfiltration\n"], "indicators": ["Path: %LocalAppData%\\MicrosoftWindowsOutlookDataPlus.txt", "Registry value name: HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\OutlookMicrosift", "Path: %AppData%\\OutlookMicrosift\\index.exe"]}], "pre-conditions": ["\nAn active internet connection for communication with Telegram and potential C2 servers.\n", "\nThe malware Small Sieve is present on the victim's system.\n", "\nAn obfuscated Base64 function is implemented within Small Sieve.\n", "\nA custom hex byte swapping encoding scheme is implemented within Small Sieve.\n", "\nThe victim's system has an active internet connection.\n", "\nA system running a vulnerable application or process.\n", "\nThe word \"Platypus\" is present in the command line arguments.\n", "\nNetwork connectivity to receive and execute commands from the attacker.\n", "\nThe ability to execute code on the target system.\n", "\nThe ability to modify file names and registry key names.\n", "\nA target system with a running instance of Small Sieve.\n", "\nKnowledge of legitimate Microsoft and Outlook naming conventions.\n", "\nThe malware Small Sieve is present in the system.\n", "\nThe attacker desires to avoid detection during casual inspection.\n"], "post-conditions": ["\nNetwork connections to unknown servers\n", "\nEncrypted data transfers\n", "\nObfuscated code fragments\n", "\nLateral movement within the network\n", "\nNew executables and files in unexpected locations\n", "\nRegistry modifications\n", "\nCompromised system integrity\n", "\nIncreased vulnerability to further attacks\n", "\nModified system settings\n", "\nLoss of sensitive information\n", "\nAltered log files with suspicious activity\n", "\nData exfiltration\n", "\nModified system processes\n", "\nCompromised system credentials\n", "\nHidden configuration files\n", "\nUnusual network connections to Telegram servers\n", "\nObfuscated command and control traffic logs\n", "\nLaZagne output files containing stolen credentials\n", "\nNew executables in user directories\n", "\nNetwork traffic anomalies\n", "\nFiles downloaded from malicious URLs\n", "\nSystem instability\n", "\nMalware persistence\n", "\nPresence of Small Sieve malware code\n", "\nModified system registry entries for persistence\n", "\nAltered log files\n", "\nModified system proxy settings\n", "\nData exfiltration\n", "\nCompromised system credentials\n", "\nNetwork reconnaissance\n", "\nModified system registry keys\n", "\nUnusual network traffic to command and control servers\n", "\nSuspicious process activity logs\n", "\nModified Outlook data files (.txt)\n", "\nSystem instability\n", "\nMalware persistence\n", "\nAltered log files\n", "\nObfuscated strings in memory\n", "\nTelegram API logs\n", "\nNew files with malicious code\n", "\nData exfiltration\n"]}, {"id": "6455174f-ef03-4f7c-9069-ca005405ff87", "attack_steps": [{"id": "bda9f0c8-bf4c-4be7-a39f-0f02a80d1ef3", "name": "Application Layer Protocol: Web Protocols as used by the malware", "description": "Application layer communication for MuddyWater's \"Small Sieve\" malware is conducted via web protocols, namely HTTP and HTTPS.  \n\nThe Telegram Bot Application Programming Interface (API) is employed by the malware to establish a connection with its command-and-control server. All communication between \"Small Sieve\" and the C2 server is executed over HTTPS, ensuring data encryption during internet transmission. \n\nCommands directed towards the malware are prefixed with \"/com[Bot ID]\" for identification as legitimate requests from the authorized Telegram Bot.  Data transmitted by \"Small Sieve\" upon beaconing to the C2 server includes the configured bot ID, the username of the currently logged-in user, and the host's IP address. \n\n\n", "mitre_technique": {"id": "T1071.001", "name": "Application layer protocol: web protocols", "description": "Adversaries may communicate using application layer protocols associated with web traffic to avoid detection/network filtering by blending in with existing traffic. Commands to the remote system, and often the results of those commands, will be embedded within the protocol traffic between the client and server."}, "pre-conditions": ["\nThe malware Small Sieve is present in the system.\n", "\nAccess to the Telegram Bot API.\n", "\nA connection to the internet is established.\n"], "post-conditions": ["\nObfuscated log files containing communication with C2 servers.\n", "\nNetwork traffic to Telegram API endpoints.\n", "\nModified system settings, including proxy configurations.\n", "\nAltered file timestamps and access logs.\n", "\nCompromised system with persistent malware infection.\n", "\nPresence of suspicious registry entries related to Small Sieve.\n", "\nData exfiltration to external servers controlled by attackers.\n", "\nSmall Sieve executable files on compromised systems.\n", "\nSystem instability and performance degradation.\n", "\nIncreased risk of further attacks and lateral movement within the network.\n", "\nTelegram bot account activity logs.\n", "\nFiles with names mimicking legitimate software (e.g., \"Microsift\", \"Outlook\").\n"], "indicators": []}, {"id": "e12ecdcf-93bd-4f55-9f66-cf297eb29c5d", "name": "Data Encoding: Non-Standard Encoding as used by the malware", "description": "MuddyWater's Small Sieve malware implements a custom hex byte swapping encoding scheme for obfuscation of tasking traffic. Data exchanged between the malware and its command-and-control server undergoes scrambling via an algorithm characterized by byte order manipulation within each data segment. This process renders the raw data unintelligible to security analysts without application of the corresponding decryption algorithm, thereby hindering comprehension of communication content.  \n", "mitre_technique": {"id": "T1132.002", "name": "Data encoding: non-standard encoding", "description": "Adversaries may encode data with a non-standard data encoding system to make the content of command and control traffic more difficult to detect. Command and control (C2) information can be encoded using a non-standard data encoding system that diverges from existing protocol specifications. Non-standard data encoding schemes may be based on or related to standard data encoding schemes, such as a modified Base64 encoding for the message body of an HTTP request."}, "pre-conditions": ["\nThe malware Small Sieve is present in the system.\n", "\nAn active internet connection for communication with the Telegram Bot API.\n", "\nThe target system has an active internet connection.\n"], "post-conditions": ["\nHex byte swapped data in network traffic.\n", "\nCompromised systems with persistent malware infections.\n", "\nData exfiltration from compromised systems.\n", "\nIncreased risk of further attacks and exploitation.\n", "\nModified system proxy settings.\n", "\nFiles containing stolen data transferred to external servers.\n", "\nUnusual network connections to known malicious IP addresses.\n", "\nObfuscated communication logs between infected systems and C2 servers via Telegram API.\n", "\nAltered system registry entries related to malware execution and persistence.\n", "\nNew user accounts or processes created by the malware.\n", "\nPotential disruption of critical infrastructure or services.\n", "\nSmall Sieve payload files on infected systems.\n"], "indicators": []}], "pre-conditions": ["\nThe malware Small Sieve is present in the system.\n", "\nAccess to the Telegram Bot API.\n", "\nA connection to the internet is established.\n", "\nThe malware Small Sieve is present in the system.\n", "\nAn active internet connection for communication with the Telegram Bot API.\n", "\nThe target system has an active internet connection.\n"], "post-conditions": ["\nObfuscated log files containing communication with C2 servers.\n", "\nNetwork traffic to Telegram API endpoints.\n", "\nModified system settings, including proxy configurations.\n", "\nAltered file timestamps and access logs.\n", "\nCompromised system with persistent malware infection.\n", "\nPresence of suspicious registry entries related to Small Sieve.\n", "\nData exfiltration to external servers controlled by attackers.\n", "\nSmall Sieve executable files on compromised systems.\n", "\nSystem instability and performance degradation.\n", "\nIncreased risk of further attacks and lateral movement within the network.\n", "\nTelegram bot account activity logs.\n", "\nFiles with names mimicking legitimate software (e.g., \"Microsift\", \"Outlook\").\n", "\nHex byte swapped data in network traffic.\n", "\nCompromised systems with persistent malware infections.\n", "\nData exfiltration from compromised systems.\n", "\nIncreased risk of further attacks and exploitation.\n", "\nModified system proxy settings.\n", "\nFiles containing stolen data transferred to external servers.\n", "\nUnusual network connections to known malicious IP addresses.\n", "\nObfuscated communication logs between infected systems and C2 servers via Telegram API.\n", "\nAltered system registry entries related to malware execution and persistence.\n", "\nNew user accounts or processes created by the malware.\n", "\nPotential disruption of critical infrastructure or services.\n", "\nSmall Sieve payload files on infected systems.\n"]}]